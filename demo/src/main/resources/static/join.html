<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>회원가입</title>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	</head>
	<body>
		<form id="join_form">
			아이디　<input type="text" id="id" name="id" placeholder="아이디">
			<button type="button" id="checkIdButton">중복 확인</button> <span id="idCheckResult"></span> <br>
			비밀번호<input type="password" id="pw" name="pw" placeholder="비밀번호"><br>
			이름　　<input type="text" id="name" name="name" placeholder="이름">
<!-- 			<input type="hidden" id="phone" name="phone" placeholder="전화번호"><br> -->
<!-- 			<input type="hidden" id="address" name="address" placeholder="주소"><br> -->
			<button type="button" onclick="submitForm()">제출</button>
		</form>
	</body>
	<script>
		$(document).ready(function() {
			$("#checkIdButton").click(function() {
				const id = $("#id").val();
				if (!id) {
				alert("아이디를 입력해주세요.");
					return;
				}
	
				$.get("/check-id", { id: id }, function(isAvailable) {
					if (isAvailable) {
						$("#idCheckResult").text("사용 가능한 아이디입니다.").css("color", "green");
					} else {
						$("#idCheckResult").text($("#id").val()+" : 이미 사용 중입니다.").css("color", "red");
						$("#id").val("");
						$("#id").focus();
					}
				}).fail(function() {
					alert("서버 요청 중 오류가 발생했습니다.");
				});
			});
		});
		
		function submitForm() {
			const id = $("#id").val();
			const pw = $("#pw").val();
			const name = $("#name").val();
			const formData = {
				id: $("#id").val(),
				name: $("#name").val(),
				pw: $("#pw").val(),
				phone: $("#phone").val(),
				address: $("address").val()
			};
			
			if (id == null || id =="") {
				alert("ID를 입력해주세요");
				id.focus();
				return false;
			} else if (pw == null || pw == "") {
				alert("비밀번호를 입력해주세요");
				pw.focus();
				return false;
			} else if (name == null || name =="") {
				alert("이름을 입력해주세요");
				name.focus();
				return false;
			}

			// AJAX 요청으로 REST Controller 호출
			$.ajax({
				url: "/user/", // REST API URL
				type: "POST",
				contentType: "application/json",
				data: JSON.stringify(formData),
				success: function(response) {
					alert("회원가입이 완료되었습니다");
					window.location.href = response.redirectUrl
				},
				error: function(xhr, status, error) {
					alert("Registration failed: " + xhr.responseText);
				}
			});
		}
	</script>
</html>